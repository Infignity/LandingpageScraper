<!DOCTYPE html>
<html lang="en">
{% include 'partials/head.html' %}

<body>
    <section class="vh-auto vw-auto">
        <div class="container py-2 h-50">
            <div class="row d-flex h-100 justify-content-center align-items-center">
                <div class="col col-lg-7 col-xl-7">
                    <div class="card rounded-3">
                        <div class="card-body p-4">

                            <h4 class="text-center my-3 pb-3">Website Crawler</h4>
                            <form class="form" method="post" id="myForm" enctype="multipart/form-data">

                                <div class="file-drop-area">
                                    <span class="choose-file-button">Choose files</span>
                                    <span class="file-message">or drag and drop files here</span>
                                    <input class="file-input" id="file" type="file" multiple>
                                </div>

                                <div class="mt-5 p-1">
                                    <button type="submit" class="btn btn-outline-success"> Submit</button>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>

            </div>

        </div>
        {% if data %}
        <div class="my-5 pt-5 justify-content-center align-items-center">
            <table class="table  table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">company web url</th>
                        <th scope="col">tag</th>
                        <th scope="col">text</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- <tr>
                        <th scope="row">1</th>
                        <td>Mark</td>
                        <td>Otto</td>
                        <td>@mdo</td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td>Jacob</td>
                        <td>Thornton</td>
                        <td>@fat</td>
                    </tr>
                    <tr>
                        <th scope="row">3</th>
                        <td colspan="2">Larry the Bird</td>
                        <td>@twitter</td>
                    </tr> -->
    
                    {% for item in data %}
                    <tr>
                        <td>{{item.id}}</td>
                        <td>{{item.url}}</td>
                        <td>{{item.tag}}</td>
                        <td>
                            {{item.text}}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-center">No feeds available</p>
            {% endif %}

        </div>

    </section>
</body>
<script>


    document.addEventListener('DOMContentLoaded', (event) => {
        document.getElementById("myForm").addEventListener("submit", function (e) {
            e.preventDefault();
            // const fileInput = document.querySelector('.file-input');
            const fileInput = document.getElementById('file');
            const selectedFile = fileInput.files[0];
            const formData = new FormData();

            formData.append('file', selectedFile);

            fetch('/scrape', {
                method: 'POST',
                body: formData
            })
                .then(resp => resp.text())
                .then(data => {
                    // clear the input fields
                    console.log(data)

                })
                .catch(error => {
                    console.error(error);
                });

        });

    });

</script>

</html>